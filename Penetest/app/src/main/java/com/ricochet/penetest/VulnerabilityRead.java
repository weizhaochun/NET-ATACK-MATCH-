package com.ricochet.penetest;

import android.app.IntentService;
import android.content.Intent;

import java.io.BufferedReader;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.net.HttpURLConnection;
import java.net.URL;

/**
 * Created by user on 2016/8/4.
 */
public class VulnerabilityRead extends IntentService {
    public  VulnerabilityRead() {
        super(" VulnerabilityRead");
    }

    @Override
    protected void onHandleIntent(Intent intent) {

        HttpURLConnection connection = null;
        StringBuilder response = new StringBuilder();

        while (response.indexOf("host(s) tested") == -1) {

            try {
                response=new StringBuilder("");
                connection = (HttpURLConnection) new URL("http://119.29.166.92/test/index2.php").openConnection();
                connection.setRequestMethod("POST");
                connection.setConnectTimeout(8000);
                connection.setReadTimeout(8000);
                connection.setDoOutput(true);
                String params = "command=nikto_status&website="+intent.getStringExtra("URI");
                connection.getOutputStream().write(params.getBytes());
                InputStream in = connection.getInputStream();
                BufferedReader reader = new BufferedReader(new InputStreamReader(in));
                String line;
                while ((line = reader.readLine()) != null) {
                    response.append(line);
                }
                Intent intentRe = new Intent("com.android.penetest.VULNERABILITY");
                String result=response.toString().replace("+","\n\n* ").replace("- Nikto v2.1.6","").replace("Target IP","目标IP").replace("Target Hostname","目标地址").replace("Target Port","目标端口")
                        .replace("Start Time","开始时间").replace("(GMT8)","(GMT8)\n\n");
                intentRe.putExtra("re",result);
                intentRe.putExtra("id",4);
                sendBroadcast(intentRe);

                Thread.sleep(1000);

            } catch (Exception e) {
                e.printStackTrace();
            }


        }
    }
}